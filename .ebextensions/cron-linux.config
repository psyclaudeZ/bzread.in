files:
    "/etc/cron.d/fetch_pinboard_cron":
        mode: "000644"
        owner: root
        group: root
        content: |
            0 0 * * 0 root /usr/local/bin/fetch_pinboard_cron.sh

    "/etc/cron.d/update_dynamodb_cron":
        mode: "000644"
        owner: root
        group: root
        content: |
            */1 * * * * root /usr/local/bin/update_dynamodb_cron.sh

    "/usr/local/bin/fetch_pinboard_cron.sh":
        mode: "000755"
        owner: root
        group: root
        content: |
            #!/bin/bash
            TOKEN=$(/opt/elasticbeanstalk/bin/get-config environment -k "PINBOARD_AUTH_TOKEN")
            curl "https://api.pinboard.in/v1/posts/all?auth_token=${TOKEN}" >> /var/log/fetch_pinboard_cron.log
            exit 0

    "/usr/local/bin/update_dynamodb_cron.sh":
        mode: "000755"
        owner: root
        group: root
        content: |
            #!/bin/bash
            # pwd >> /var/log/update_dynamodb_cron.log
            node --version &> /var/log/update_dynamodb_cron.log
            npm install -g ts-node &> /var/log/update_dynamodb_cron.log
            /var/app/current/src/scripts/dump.ts &> /var/log/update_dynamodb_cron.log
            exit 0

    "/opt/elasticbeanstalk/tasks/taillogs.d/custom_log.conf" :
        mode: "000755"
        owner: root
        group: root
        content: |
            /var/log/update_dynamodb_cron.log
            /var/log/fetch_pinboard_cron.log
    
commands:
    remove_old_cron:
        command: "rm -f /etc/cron.d/fetch_pinboard_cron.bak /etc/cron.d/update_dynamodb_cron.bak"